# 进一步分包：预编译资源模块

- 分包：设置Externals

  - 思路：将react, react-dom 基础包通过cdn引入，不打入bundle中
  - 方法：使用html-webpack-externals-plugin
  - 缺点：一个个的分包麻烦，因为不止是有react包，还有其他的包...（是这么个意思吗— . —）

- 进一步分包：预编译资源模块

  - 思路： 将react, react-dom，redux, react-redux基础包和业务基础包打包成一个文件

  - 方法：使用DLLPlugin进行分包，DLLReferencePlugin对manifest.json引用

    ```js
    // 编写dll文件
    // 分包
    const path = require('path');
    const webpack = require('webpack');
    const TerserPlugin = require('terser-webpack-plugin');
    
    module.exports = {
        mode: 'production',
        entry: {
            react: [
                'react',
                'react-dom'
            ]
        },
        optimization: {
            minimize: true,
            minimizer: [
                new TerserPlugin({
                    extractComments: false // 保证不把打包的注释单独提出作为一个txt文件
                })
            ]
        },
        output: {
            filename: '[name]_[chunkhash].dll.js',
            path: path.join(__dirname, 'build/library'),
            library: '[name]',
            clean: true
        },
        plugins: [
            new webpack.DllPlugin({
                name: '[name]',
                path: path.join(__dirname, 'build/library/manifest.json')
            })
        ]
    }
    ```

    ```js
    // 在package.json里配置脚本
    "scripts": {
        "dll": "webpack --config webpack.dll.js"
      },
    ```

    - 理论来说，会生成一个manifest.json文件和一个react.dll.js包，但是实际没有。我不知道是版本问题还是我的问题

    - 再把打包出来的manifest.json在prod.js里引用

      ```js
      plugins: [
          new webpack.DllReferencePlugin({
              context: __dirname,
              manifest: require('./build/library/manifest.json'),
              sourceType: 'commonjs'
          }),
      ]
      ```

      *注*：dllPlugin已经比较老旧了，webpack4已经不再维护