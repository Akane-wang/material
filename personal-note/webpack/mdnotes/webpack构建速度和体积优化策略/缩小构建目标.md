# 缩小构建目标

- 目的：尽可能的少构建模块
  - 比如babel-loader不解析node_modules
- 减少文件搜索范围
  - 优化resolve.modules配置（减少模块搜索层级）
  - 优化resolve.mainFields配置
  - 优化resolve.extensions配置
  - 合理使用alias

```js
'use strict';

const { setMPA } = require('./utils');
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
// const OptimizeCssAssetsWebpackPlugin = require('optimize-css-assets-webpack-plugin'); // webpack@4
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin'); // webpack@5压缩
// const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');
const SpeedMeasurePlugin = require("speed-measure-webpack-plugin");

const smp = new SpeedMeasurePlugin();
// const CleanWebpackPlugin = require('clean-webpack-plugin');
// const webpack = require('webpack');

const { entry, htmlWebpackPlugins } = setMPA();
const TerserPlugin = require('terser-webpack-plugin');

// const HardSourceWebpackPlugin = require('hard-source-webpack-plugin');
module.exports = smp.wrap({
    //...
    // *******模块查找策略*******
    resolve: {
        alias: {
            'react': path.resolve(__dirname, '/node_modules/react/umd/react.production.min.js'),
            'react-dom': path.resolve(__dirname, '/node_modules/react-dom/umd/react-dom.production.min.js')
        },
        extensions: ['.js'], // 如果是tsx或者其他的，就要设置成tsx或者其他后缀
        mainFields: ['main']
    },
    module: {
        rules: [
            {
                test: /\.js$/,
                include: path.resolve('src'), // *******只查找src下的js文件*******
                //use: [
                    //{
                        //loader: 'thread-loader', // 我仿佛，来到了知识的荒原，为什么加了这个插件，反而更久？我炸了
                        //options: {
                            //workers: 2
                        //}
                   // },
                //]
            //},
    },
    plugins: [
        // ...
    ].concat(htmlWebpackPlugins),
});
```

