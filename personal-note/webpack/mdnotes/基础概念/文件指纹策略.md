# 文件指纹

- 文件指纹：打包后输出的文件名的后缀

## 文件指纹如何生成

- Hash: 和整个项目的构建相关，只要项目文件有修改，整个项目构建的hash值就会更改
- Chunkhash: 和webpack打包的chunk有关，不同的entry会生成不同的chunkhash值
- Contenthash: 根据文件内容来定义hash, 文件内容不变，则contenthash不变

### JS的文件指纹设置

- 设置output的filename，使用[chunkhash]

  ```js
  module.exports = {
      entry: {
          // 略
      },
      output: {
          path: path.join(__dirname, 'dist'),
          filename: '[name][chunkhash:8].js', // here
      },
  }
  ```

  

### CSS的文件指纹设置

- 设置MiniCSSExtractPlugin的filename, 使用【contenthash】

- **style-loader与MiniCssExtractPlugin无法共存，会有冲突，因此需要将style-loader替换成MiniCssExtractPlugin.loader**

  ```js
  const MiniCssExtractPlugin = require('mini-css-extract-plugin');
  module.exports = {
      module: {
          rules: [
              {
                  test: /\.css$/,
                  use: [
                      MiniCssExtractPlugin.loader, // 'style-loader' 替换成MiniCssExtractPlugin.loader,
                      'css-loader'
                  ]
              },
              {
                  test: /\.less$/,
                  use: [
                      MiniCssExtractPlugin.loader, // 'style-loader' 替换成MiniCssExtractPlugin.loader,
                      'css-loader',
                      'less-loader'
                  ]
              },
          ]
      },
      plugins: [
          new HTMLWebpackPlugin({ template: './src/index.html'}),
          new MiniCssExtractPlugin({ // 提取css成独立的文件
              filename: `[name][contenthash:8].css` // 需要注意的是，mini-css-extract-plugin无法与style-loader共用，因为对css的处理是有冲突的。
          }),
      ]
  }
  ```

### 文件或字体资源指纹设置

- 设置file-loader的name, 使用【hash】

```js
module.exports = {
    module: {
        rules: [
            {
                test: /\.(png|jpg|jpeg|gif)$/,
                use: [{
                    loader: 'file-loader',
                    options: {
                        name: 'img/[name][hash:8].[ext]' // ext: 后缀
                    }
                }],
            }
        ]
    }
}
```



### 占位符名称一览表

| 占位符名称      | 含义                          |
| --------------- | ----------------------------- |
| 【ext】         | 资源后缀名                    |
| 【name】        | 文件名称                      |
| 【path】        | 文件的相对路径                |
| 【folder】      | 文件所在的文件夹              |
| 【contenthash】 | 文件的内容hash, 默认是md5生成 |
| 【hash】        | 文件内容的hash, 默认是md5生成 |
| 【emoji】       | 一个随机的指代文件内容的emoji |

