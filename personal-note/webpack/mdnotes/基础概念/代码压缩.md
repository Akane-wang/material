# 代码压缩
- HTML代码压缩

  - 修改html-webpack-plugin，设置压缩参数

  - 一个页面对应一个html-webpack-plugin

  - 使用方式是：

    ```js
    // 引入html-webpack-plugin
    const HTMLWebpackPlugin = require('html-webpack-plugin'); // 不用手动添加打包结果到index.html,webpack自动添加其置。
    // 在plugins里面添加html-webpack-plugin, 并设置对应配置; 多页面打包时，需要多个html-webpack-plugin
    plugins: [
            new HTMLWebpackPlugin({
                template: './src/index.html',
                filename: 'index.html',
                chunks: ['index'],
                inject: true,
                minify: {
                    html: true,
                    collapseInlineTagWhitespace: true,
                    preserveLineBreaks: true,
                    minifyCSS: true,
                    minifyJS: true,
                    removeComments: false
                }
            }),
            new HTMLWebpackPlugin({
                template: './src/index.html',
                filename: 'search.html',
                chunks: ['search'],
                inject: true,
                minify: {
                    html: true,
                    collapseInlineTagWhitespace: true,
                    preserveLineBreaks: true,
                    minifyCSS: true,
                    minifyJS: true,
                    removeComments: false
                }
            }),
    ]
    ```

    

- js代码压缩

  - 内置了unglifyjs-webpack-plugin
  - 可以自己额外安装该内置plugin再配置一些其他参数去做压缩配置，比如并行压缩

- css代码压缩

  - 使用optimize-css-assets-webpack-plugin；webpack@5更新为css-minimizer-webpack-plugin

  - 同时使用cssnano预处理器

    - 代码压缩的方式是，在`mini-css-extract-plugin()`把css分离出来的基础上再对其进行压缩；压缩需要的步骤如下：

      - `npm i css-minimizer-webpack-plugin -D` 安装压缩插件

      - 引入CssMinimizerPlugin: `const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');`

      - 在何处使用该插件呢？

        - 生产环境下：

          ```js
          optimization: {
              minimizer: [
                  new CssMinimizerPlugin(),
              ]
          },
          ```

        - 开发环境下：

          ```js
          optimization: {
              minimize: true,
              minimizer: [
                  new CssMinimizerPlugin(),
              ]
          }
          ```

        - 如何使用cssnano呢？设置minimizerOptions: { preset: {'default'}} 即可；出处是

            | **[`minimizerOptions`](https://webpack.docschina.org/plugins/css-minimizer-webpack-plugin/#minimizeroptions)** | `Object|Array<Object>` | `{ preset: 'default' }` | Cssnano 优化 [配置项](https://cssnano.co/docs/optimisations)。 |
          | ------------------------------------------------------------ | ---------------------- | ----------------------- | ------------------------------------------------------------ |

          ```js
          module.exports = {
              optimization: {
                  minimize: true,
                  minimizer: [
                      new CssMinimizerPlugin({
                          minimizerOptions: {
                              preset: [
                                  "default", // minimizerOptions	Object|Array<Object>	{ preset: 'default' }	Cssnano 优化 配置项。
                                  //...
                              ]
                          }
                      })
                  ]
              }
          }
          ```

  
    
  
  - CSS压缩配置理应如下所示：
  
    ```js
    'use strict';
    
    const path = require('path');
    const MiniCssExtractPlugin = require('mini-css-extract-plugin');
    const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
    module.exports = {
        entry: {
            //...
        },
        output: {
            path: path.join(__dirname, 'dist'),
            filename: '[name][chunkhash:8].js',
        },
        mode: 'production', // 'development' | 'production', wds需要在开发环境而非生产环境下
        optimization: {
            minimize: true, // 开发环境配置
            minimizer: [
                new CssMinimizerPlugin({
                    minimizerOptions: { // 具体配置
                        preset: [
                            "default"
                        ]
                    }
                }),
            ]
        },
        module: {
            rules: [
                {
                    test: /\.css$/,
                    use: [
                        // 'style-loader',
                        MiniCssExtractPlugin.loader,
                        'css-loader'
                    ]
                },
                {
                    test: /\.less$/,
                    use: [
                        MiniCssExtractPlugin.loader, // 'style-loader', // 与mini-css-extract-plugin不能共存, style-loader替换成MiniCssExtractPlugin.loader,
                        'css-loader',
                        'less-loader'
                    ]
                },
            ]
        },
        plugins: [
            new MiniCssExtractPlugin({ // 提取css成独立的文件
                filename: '[name][contenthash:8].css'
            })
        ]
    }
    ```
  
    