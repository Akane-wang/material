# 多页面应用打包通用方案

- 多页面应用（MPA）概念

  - 每一次页面跳转的时候，后台服务器都会返回一个新的html文档，这种类型的网站也就是多页网站，也叫多页应用。
  - 页面之间是解耦的
  - xxxxxxxxxx   entry: {      'index': './src/index.js',      'search': './src/search.js'  },  output: {      path: path.join(__dirname, 'dist'),      filename: '[name].js' // [name]：占位符，即为index.js, search.js  }js

- 多页面打包基本思路

  - 每个页面对应一个entry, 一个html-webpack-plugin

    - 缺陷： 每次新增或者删除页面需要改webpack配置

  - 动态获取entry和设置html-webpack-plugin数量

    - 利用glob.sync

      - 约定放置目录和js的文件名

      ```js
      entry: glob.sync(path.join(__dirname, './src/*/index.js'))
      ```

      ```js
      // utils.js
      // 需要一个方法可以实现获取entry和plugins
      'use strict';
      const glob = require('glob');
      const HTMLWebpackPlugin = require('html-webpack-plugin'); // 不用手动添加打包结果到index.html,webpack自动添加其置。
      module.exports = {
          setMPA: () => {
              const entry = {};
              const htmlWebpackPlugin = [];
      
              const entryFiles = glob.sync('./src/page/*/index.js'); // 约定多页面的页面写到src/page/页面名字/index.js; 模板写到同目录下的index.html
              Object.keys(entryFiles).map((index) => {
                  const entryFile = entryFiles[index];
      
                  const matchRes = entryFile.match(/src\/page\/(.*)\/index\.js/); // 匹配出名字
      
                  const pageName = matchRes && matchRes[1];
      
                  entry[pageName] = entryFile; // 设置名字和js成功；出来的结果是： {‘[index]’: './src/page/index/[index].js', ...}
      
                  htmlWebpackPlugin.push( // htmlWebpackPlugins集合；更换template和fileName即可
                      new HTMLWebpackPlugin({
                          template: `./src/page/${pageName}/index.html`,
                          filename: `${pageName}[hash:8].html`,
                          chunks: [pageName],
                          inject: true,
                          minify: {
                              html: true,
                              collapseInlineTagWhitespace: true,
                              preserveLineBreaks: true,
                              minifyCSS: true,
                              minifyJS: true,
                              removeComments: false
                          }
                      }),
                  )
              })
              return {
                  entry,
                  htmlWebpackPlugin
              }
          }
      }
      ```
      
```js
      //webpack.prod.js
      'use strict';
      
      const { setMPA } = require('./utils');
      const path = require('path');
      const MiniCssExtractPlugin = require('mini-css-extract-plugin');
      const CssMinimizerPlugin = require('css-minimizer-webpack-plugin'); // webpack@5压缩
      
      const { entry, htmlWebpackPlugin } = setMPA(); // 获取entry和htmlwebpackPlugin
      module.exports = {
          entry: entry, // 在此配置entry
          output: {
              //...
          },
          mode: 'production', // 'development' | 'production', wds需要在开发环境而非生产环境下
          
          plugins: [
              //...plugins的集合
              new MiniCssExtractPlugin({ // 提取css成独立的文件
                  filename: '[name][contenthash:8].css'
              }),
          ].concat(htmlWebpackPlugin) // 添加html-webpack-plugin
      }
```

