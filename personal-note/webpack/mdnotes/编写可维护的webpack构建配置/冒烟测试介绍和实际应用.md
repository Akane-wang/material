# 冒烟测试（smoke testing)

- 冒烟测试是指对提交测试的软件在进行详细深入的测试之前而进行的预测试，这种预测试的主要目的是暴露导致软件需重新发布的基本功能失效等严重问题

- 冒烟测试执行

  - 构建是否成功

    - 在示例项目里运行构建，看是否报错

      - 运行test里的index文件，主要做的事情是，运行webpack的某个文件（webpack.prod.js），以判断webpack是否能正常构建

        ```js
        const path = require('path');
        const webpack = require('webpack');
        const rimraf = require('rimraf');
        // const Mocha = require('mocha');
        
        // const mocha = new Mocha({
            // timeout: '100000ms',
        // });
        process.chdir(path.join(__dirname, 'template'));
        rimraf('./dist', () => {
            // eslint-disable-next-line global-require
            const prodConfig = require('../../lib/webpack.prod'); // 此处千万不能提到外面去，否则就会先运行prodConfig文件
            webpack(prodConfig, (err, stats) => {
                if (err) {
                    console.log(err);
                    process.exit(2);
                }
                console.log(stats.toString({
                    colors: true,
                    modules: false,
                    children: false,
                }));
        
                // mocha.addFile(path.join(__dirname, 'html-test.js'));
                // mocha.addFile(path.join(__dirname, 'css-js-test.js'));
                // mocha.run();
            });
        });
        
        ```

        

  - 每次构建完成build目录是否有内容输出（编写mocha测试用例）

    - 是否有js, css等静态资源文件

    - 是否有html文件

      ```js
      // 增添了mocha相关代码 index.js
      const path = require('path');
      const webpack = require('webpack');
      const rimraf = require('rimraf');
      const Mocha = require('mocha');
      
      const mocha = new Mocha({
          timeout: '100000ms',
      });
      process.chdir(path.join(__dirname, 'template'));
      rimraf('./dist', () => {
          // eslint-disable-next-line global-require
          const prodConfig = require('../../lib/webpack.prod');
          webpack(prodConfig, (err, stats) => {
              if (err) {
                  console.log(err);
                  process.exit(2);
              }
              console.log(stats.toString({
                  colors: true,
                  modules: false,
                  children: false,
              }));
      
              mocha.addFile(path.join(__dirname, 'html-test.js')); // 添加了检查是否有html文件的代码
              mocha.addFile(path.join(__dirname, 'css-js-test.js')); // 添加了检查是否有css, js文件的代码
              mocha.run();
          });
      });
      
      ```

      ```js
      // html-test.js：检查html是否存在
      const glob = require('glob-all');
      describe('Checking generated html files', () => {
          it('should generate html files', (done) => {
              const files = glob.sync([
                  './dist/index.html',
                  './dist/search.html',
              ]);
      
              if (files.length > 0) {
                  done();
              } else {
                  throw new Error('no html files generated');
              }
          });
      });
      
      ```

      ```js
      // 检查css,js是否存在
      const glob = require('glob-all');
      describe('Checking generated css js files', () => {
          it('should generate css js files', (done) => {
              const files = glob.sync([
                  './dist/index_*.js',
                  './dist/search_*.js',
                  './dist/index_*.css',
                  './dist/search_*.css',
              ]);
      
              if (files.length > 0) {
                  done();
              } else {
                  throw new Error('no css js files generated');
              }
          });
      });
      
      ```

      

      